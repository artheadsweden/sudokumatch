<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudoku Game</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.3/css/bulma.min.css">
    <style>
        .sudoku-grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 2px; /* Adjust gap for cell spacing */
            max-width: 450px; /* Adjust max width of the grid */
            margin: auto; /* Center the grid horizontally */
        }
        .sudoku-cell {
            position: relative;
            text-align: center;
            padding: 10px; /* Reduced padding */
            border: 1px solid #ddd;
            font-size: 16px; /* Reduced font size */
            display: flex;
            justify-content: center;
            align-items: center;
            aspect-ratio: 1; /* Keeps cells square */
            user-select: none; /* Prevent default select action */
        }

        /* Style for thicker borders */
        .sudoku-grid > :nth-child(3n) {
            border-right: 3px solid black;
        }
        .sudoku-grid > :nth-child(n+19):nth-child(-n+27),
        .sudoku-grid > :nth-child(n+46):nth-child(-n+54),
        .sudoku-grid > :nth-child(n+73):nth-child(-n+81) {
            border-bottom: 3px solid black;
        }
            .given-number {
            color: blue;
            font-weight: bold;
        }
    .button-round {
        border-radius: 50%; /* Makes the button round */
        width: 40px; /* Adjust width as needed */
        height: 40px; /* Adjust height as needed */
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 5px; /* Spacing between buttons */
        box-shadow: 2px 2px 3px black;
    }
    .button-disabled {
        background-color: #cc3300;
        color: #fff;
    }

    .buttons-container {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 20px; /* Space above the button section */
    }
    .is-selected {
        background-color: #cccccc !important;
        color: #cc3300 !important;
        font-weight: bold !important;
        border-color: #cccccc !important;
    }

    .pencil-marks {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(3, 1fr);
        font-size: 0.5em; /* Smaller font size for pencil marks */
    }

    .mark-1 { grid-column: 1; grid-row: 1; } /* top left */
    .mark-2 { grid-column: 2; grid-row: 1; } /* top center */
    .mark-3 { grid-column: 3; grid-row: 1; } /* top right */
    .mark-4 { grid-column: 1; grid-row: 2; } /* middle left */
    .mark-5 { grid-column: 2; grid-row: 2; } /* center */
    .mark-6 { grid-column: 3; grid-row: 2; } /* middle right */
    .mark-7 { grid-column: 1; grid-row: 3; } /* bottom left */
    .mark-8 { grid-column: 2; grid-row: 3; } /* bottom center */
    .mark-9 { grid-column: 3; grid-row: 3; } /* bottom right */

    .sudoku-cell.highlight {
        background-color: rgba(255, 255, 0, 0.75); /* Yellow background for the entire cell */
        border-radius: 50%; /* Optional: if you want rounded corners */
    }

    /* Highlighting for individual pencil marks */
    .pencil-marks .highlight {
        background-color: rgba(255, 0, 0, 0.75); /* Yellow background for pencil marks */
    }

    .highlight {
        background-color: rgba(255, 255, 0, 0.75);
        /* border-radius: 50%; */
    }

    /* Highlighting for individual pencil marks */
    .pencil-marks .highlight::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 0, 0.75);
        border-radius: 50%;
        z-index: -1;
    }
 
    </style>
</head>
<body>
    <section class="section">
        <div class="container">
            <h1 class="title">Sudoku Game</h1>
            <div class="sudoku-grid">
                {% for i in range(81) %}
                    {% set value = sudoku[i] %}
                        <div class="{{ 'sudoku-cell' if value == '0' else 'sudoku-cell given-number' }}" 
                            onclick="cellClicked(this, '{{ i }}', event)"
                        >
                   {{ value if value != '0' else '' }}
               </div>
               
                {% endfor %}
            </div>
            <!-- Buttons and other controls -->
            <div class="buttons-container">
                {% for i in range(1, 10) %}
                    <button class="button button-round" onclick="selectDigit({{ i }})">{{ i }}</button>
                {% endfor %}
                <button class="button button-round" onclick="selectDigit('erase')">X</button>
            </div>
        </div>
    </section>

    <script>
        let selectedDigit = 1;
        checkDigitCounts();
        document.querySelector(`button[onclick="selectDigit(1)"]`).classList.add('is-selected');
        highlightDigits('1');


        function checkDigitCounts() {
            for (let digit = 1; digit <= 9; digit++) {
                let count = 0;
                document.querySelectorAll('.sudoku-cell').forEach(cell => {
                    if (cell.textContent.trim() === digit.toString()) {
                        count++;
                    }
                });

                // Enable/disable the button based on the count
                const button = document.querySelector(`button[onclick="selectDigit(${digit})"]`);
                if (count === 9) {
                    button.disabled = true;
                } else {
                    button.disabled = false;
                }
            }
        }


        function selectDigit(digit) {
            // Remove 'is-selected' class from all buttons
            document.querySelectorAll('.button-round').forEach(button => {
                button.classList.remove('is-selected');
            });

            // Add 'is-selected' class to the clicked button
            if (digit === 'erase') {
                document.querySelector('button[onclick="selectDigit(\'erase\')"]').classList.add('is-selected');
            } else {
                document.querySelector(`button[onclick="selectDigit(${digit})"]`).classList.add('is-selected');
            }

            // Set the selected digit or 'erase'
            selectedDigit = digit;
            // Highlight all instances of the selected digit
            highlightCells(digit);
            highlightDigits(digit);
        }

        function highlightDigits(digit) {
            // Remove existing highlights
            document.querySelectorAll('.highlight').forEach(highlighted => {
                highlighted.classList.remove('highlight');
            });

            if (digit !== 'erase') {
                document.querySelectorAll('.sudoku-cell').forEach(cell => {
                    let cellContent = cell.textContent.trim();

                    // Only highlight pencil marks if the cell doesn't have a main digit
                    if (cellContent === ' ') {
                        cell.querySelectorAll('.pencil-marks .mark-' + digit).forEach(mark => {
                            mark.classList.add('highlight');
                        });
                    }
                });
            }
        }

        function cellClicked(cell, index, event) {
            if (selectedDigit === null) return; // No digit selected

            if (cell.classList.contains('given-number')) return; // Ignore clicks on given numbers

            // Check if the cell is empty (ignoring pencil marks)
            const isCellEmpty = !cell.firstChild || cell.firstChild.nodeType !== Node.TEXT_NODE || cell.textContent.trim() === '';

            if (event.shiftKey) {
                // Toggle pencil marks regardless of whether the cell is empty or not
                togglePencilMark(cell, selectedDigit);
            } else {
                // Check if 'erase' is selected
                if (selectedDigit === 'erase') {
                    cell.textContent = ''; // Erase the digit
                } else {
                    // For a regular click, place or erase a digit
                    if (isCellEmpty || cell.textContent === selectedDigit.toString()) {
                        cell.textContent = selectedDigit; // Place new digit or erase if same digit
                    }
                }
            }

            // Update highlighting and check digit counts
            highlightCells(selectedDigit);
            highlightDigits(selectedDigit);
            checkDigitCounts();
        }
    

        function togglePencilMark(cell, digit) {
            // Create a container for pencil marks if it doesn't exist
            let pencilMarks = cell.querySelector('.pencil-marks');
            if (!pencilMarks) {
                pencilMarks = document.createElement('div');
                pencilMarks.classList.add('pencil-marks');
                cell.appendChild(pencilMarks);
            }

            // Check if the digit is already marked
            let mark = pencilMarks.querySelector(`.mark-${digit}`);
            if (mark) {
                // Remove existing mark
                pencilMarks.removeChild(mark);
            } else {
                // Add new mark
                mark = document.createElement('span');
                mark.classList.add(`mark-${digit}`);
                mark.textContent = digit;
                pencilMarks.appendChild(mark);
            }
            highlightDigits(selectedDigit);

        }
    </script>
</body>
</html>
